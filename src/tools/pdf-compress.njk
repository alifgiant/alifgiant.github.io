---
layout: layouts/base.njk
title: PDF Compressor
permalink: /tools/pdf-compress/
---

{# PDF-LIB for PDF manipulation #}
<script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
{# JSZip for Batch Downloads #}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<div class="w-full max-w-4xl flex flex-col gap-12" x-data="pdfCompressor()">
    {# Header #}
    <div class="flex flex-col gap-4 text-center items-center">
        <div class="p-4 rounded-full bg-indigo-50 text-indigo-600 mb-2">
            <span class="material-symbols-outlined text-4xl">sync</span>
        </div>
        <h1 class="text-4xl md:text-6xl font-bold text-text-main font-display">
            PDF Compressor
        </h1>
        <p class="text-lg text-text-muted max-w-xl leading-relaxed">
            Reduce the file size of your PDF documents quickly and securely. All processing happens locally in your browser.
        </p>
    </div>

    {# Tool Card #}
    <div class="bg-white/80 backdrop-blur-md border border-white rounded-[2.5rem] p-8 md:p-12 shadow-2xl shadow-primary/10 transition-all duration-500">
        
        {# Drop Zone & Settings #}
        <div class="flex flex-col gap-8">
            {# Multiple Drop Zone #}
            <div @dragover.prevent="dragOver = true" 
                 @dragleave.prevent="dragOver = false" 
                 @drop.prevent="handleDrop($event)"
                 :class="dragOver ? 'border-indigo-400 bg-indigo-50/50 scale-[1.01]' : 'border-stone-200 bg-stone-50/30'"
                 class="relative group border-2 border-dashed rounded-3xl p-10 transition-all duration-300 flex flex-col items-center justify-center gap-6 cursor-pointer overflow-hidden">
                
                <input type="file" multiple accept="application/pdf" class="absolute inset-0 opacity-0 cursor-pointer" @change="handleFileSelect($event)">
                
                <div class="p-5 rounded-2xl bg-white shadow-sm border border-stone-100 group-hover:scale-110 group-hover:rotate-3 transition-transform duration-500">
                    <span class="material-symbols-outlined text-4xl text-indigo-500">upload_file</span>
                </div>
                
                <div class="text-center">
                    <h3 class="text-lg font-bold text-text-main mb-1">Click or drag PDF files here</h3>
                    <p class="text-xs text-text-muted">Batch process up to 10 files at once</p>
                </div>
            </div>

            {# Compression Intensity Settings #}
            <div class="flex flex-col gap-4">
                <label class="text-[10px] font-bold uppercase tracking-widest text-text-muted ml-1">Compression Intensity</label>
                <div class="grid grid-cols-3 gap-3">
                    <button @click="intensity = 'low'" :class="intensity === 'low' ? 'bg-indigo-600 text-white shadow-lg shadow-indigo-200' : 'bg-stone-50 text-text-muted hover:bg-stone-100'" class="px-4 py-3 rounded-xl text-xs font-bold transition-all border border-stone-100 italic">Basic</button>
                    <button @click="intensity = 'medium'" :class="intensity === 'medium' ? 'bg-indigo-600 text-white shadow-lg shadow-indigo-200' : 'bg-stone-50 text-text-muted hover:bg-stone-100'" class="px-4 py-3 rounded-xl text-xs font-bold transition-all border border-stone-100 italic">Strong</button>
                    <button @click="intensity = 'high'" :class="intensity === 'high' ? 'bg-indigo-600 text-white shadow-lg shadow-indigo-200' : 'bg-stone-50 text-text-muted hover:bg-stone-100'" class="px-4 py-3 rounded-xl text-xs font-bold transition-all border border-stone-100 italic">Insane</button>
                </div>
            </div>
        </div>

        {# File List #}
        <div x-show="files.length > 0" class="mt-12 flex flex-col gap-4 animate-fade-in" x-cloak>
            <div class="flex justify-between items-center mb-2">
                <h4 class="text-sm font-bold text-text-main" x-text="`Queue (${files.length} files)`"></h4>
                <button @click="clearAll()" class="text-[10px] font-bold text-rose-500 hover:text-rose-600 uppercase tracking-widest">Clear All</button>
            </div>

            <div class="flex flex-col gap-3">
                <template x-for="(f, index) in files" :key="f.id">
                    <div class="flex items-center gap-4 p-4 bg-stone-50 rounded-2xl border border-stone-100 transition-all" :class="f.status === 'done' ? 'bg-emerald-50/30 border-emerald-100' : ''">
                        <div class="p-2 rounded-lg bg-white shadow-sm border border-stone-50">
                            <span class="material-symbols-outlined text-xl" :class="f.status === 'done' ? 'text-emerald-500' : 'text-indigo-400'">picture_as_pdf</span>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex justify-between items-start">
                                <span class="text-sm font-bold text-text-main truncate pr-4" x-text="f.name"></span>
                                <span class="text-[10px] font-bold px-2 py-0.5 rounded-full" 
                                      :class="{
                                          'bg-stone-200 text-stone-600': f.status === 'queued',
                                          'bg-indigo-100 text-indigo-600 animate-pulse': f.status === 'processing',
                                          'bg-emerald-100 text-emerald-600': f.status === 'done',
                                          'bg-rose-100 text-rose-600': f.status === 'error'
                                      }" x-text="f.status.toUpperCase()"></span>
                            </div>
                            <div class="flex gap-3 mt-1 items-center">
                                <template x-if="f.status === 'done'">
                                    <div class="flex items-center gap-2">
                                        <span class="text-[10px] text-rose-500 line-through decoration-rose-500 font-medium" x-text="formatSize(f.size)"></span>
                                        <span class="material-symbols-outlined text-[10px] text-stone-400">arrow_forward</span>
                                        <span class="text-[10px] font-bold text-emerald-600" x-text="formatSize(f.blob?.size || 0)"></span>
                                        <span class="text-[10px] font-bold px-1.5 py-0.5 bg-emerald-100 text-emerald-700 rounded ml-1" x-text="' - ' + f.reduction + ' % '"></span>
                                    </div>
                                </template>
                                <template x-if="f.status !== 'done'">
                                    <span class="text-[10px] text-text-muted" x-text="formatSize(f.size)"></span>
                                </template>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <template x-if="f.status === 'done'">
                                <a :href="f.downloadUrl" :download="f.resultName" class="p-2 text-indigo-500 hover:bg-indigo-100 rounded-lg transition-all">
                                    <span class="material-symbols-outlined">download</span>
                                </a>
                            </template>
                            <button @click="removeFile(index)" class="p-2 text-stone-400 hover:text-rose-500 hover:bg-rose-50 rounded-lg transition-all">
                                <span class="material-symbols-outlined">close</span>
                            </button>
                        </div>
                    </div>
                </template>
            </div>

            {# Actions #}
            <div class="mt-8 flex flex-col gap-4">
                <button @click="processAll()" :disabled="!isAnyQueued || processing" class="group relative flex items-center justify-center gap-3 w-full py-5 bg-indigo-600 text-white rounded-2xl font-bold text-xl hover:bg-indigo-700 transition-all duration-300 shadow-xl shadow-indigo-200/50 active:scale-[0.98] disabled:opacity-50 overflow-hidden">
                    <span x-show="!processing">Compress All</span>
                    <span x-show="processing" class="flex items-center gap-2">
                        <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        Batch Processing...
                    </span>
                    <span x-show="!processing" class="material-symbols-outlined group-hover:translate-y-1 transition-transform">bolt</span>
                </button>

                <div x-show="isAllDone && files.length > 0" class="flex flex-col gap-6 animate-fade-in">
                    <div class="p-6 bg-indigo-50/50 rounded-3xl border border-indigo-100 flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <div class="p-3 rounded-2xl bg-white shadow-sm border border-indigo-50">
                                <span class="material-symbols-outlined text-indigo-500">analytics</span>
                            </div>
                            <div>
                                <h4 class="text-sm font-bold text-text-main">Batch Summary</h4>
                                <p class="text-xs text-text-muted" x-text="`Processed ${files.filter(f => f.status === 'done').length} files`"></p>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-xl font-black text-indigo-600" x-text="' - ' + totalReduction + ' % '"></div>
                            <div class="text-[10px] font-bold uppercase tracking-widest text-text-muted" x-text="' Saved ' + formatSize(totalSaved) + ' total '"></div>
                        </div>
                    </div>

                    <button @click="downloadZip()" x-show="files.length > 1" class="flex items-center justify-center gap-3 w-full py-4 border-2 border-indigo-600 text-indigo-600 bg-white rounded-2xl font-bold text-lg hover:bg-indigo-50 transition-all duration-300 active:scale-[0.98]">
                        Download All as ZIP
                        <span class="material-symbols-outlined">inventory_2</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    {# Info Sections #}
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <div class="bg-indigo-50/50 rounded-3xl p-8 border border-indigo-100 flex gap-4">
            <span class="material-symbols-outlined text-indigo-600 text-3xl">privacy_tip</span>
            <div>
                <h4 class="font-bold text-text-main mb-2">Local Processing</h4>
                <p class="text-sm text-text-muted leading-relaxed">
                    Unlike other online converters, your PDF NEVER leaves your computer. We process it using JavaScript right in your browser.
                </p>
            </div>
        </div>
        <div class="bg-indigo-50/50 rounded-3xl p-8 border border-indigo-100 flex gap-4">
            <span class="material-symbols-outlined text-indigo-600 text-3xl">bolt</span>
            <div>
                <h4 class="font-bold text-text-main mb-2">Optimized Output</h4>
                <p class="text-sm text-text-muted leading-relaxed">
                    We use object stream compression and optimization to reduce file size while maintaining the quality of your text and layout.
                </p>
            </div>
        </div>
    </div>

    {# Back Button #}
    <div class="flex justify-center">
        <a href="/tools/" class="flex items-center gap-2 text-text-muted hover:text-primary transition-colors font-bold uppercase tracking-widest text-xs">
            <span class="material-symbols-outlined text-sm">arrow_back</span>
            Back to Tools
        </a>
    </div>
</div>

<script>
    function pdfCompressor() {
        return {
            files: [],
            dragOver: false,
            processing: false,
            intensity: 'medium',
            progress: 0,
            
            get isAnyQueued() {
                return this.files.some(f => f.status === 'queued');
            },

            get isAllDone() {
                return this.files.length > 0 && this.files.every(f => f.status === 'done' || f.status === 'error');
            },

            get totalSaved() {
                const doneFiles = this.files.filter(f => f.status === 'done');
                const totalOrig = doneFiles.reduce((acc, f) => acc + f.size, 0);
                const totalNew = doneFiles.reduce((acc, f) => acc + (f.blob?.size || 0), 0);
                return Math.max(0, totalOrig - totalNew);
            },

            get totalReduction() {
                const doneFiles = this.files.filter(f => f.status === 'done');
                const totalOrig = doneFiles.reduce((acc, f) => acc + f.size, 0);
                const totalNew = doneFiles.reduce((acc, f) => acc + (f.blob?.size || 0), 0);
                if (totalOrig === 0) return 0;
                return ((totalOrig - totalNew) / totalOrig * 100).toFixed(1);
            },

            handleFileSelect(e) {
                const selectedFiles = Array.from(e.target.files);
                this.addFiles(selectedFiles);
                e.target.value = ''; // Reset input
            },

            handleDrop(e) {
                this.dragOver = false;
                const droppedFiles = Array.from(e.dataTransfer.files);
                this.addFiles(droppedFiles);
            },

            addFiles(fileList) {
                fileList.forEach(file => {
                    if (file.type === 'application/pdf') {
                        if (this.files.length < 10) {
                            this.files.push({
                                id: Math.random().toString(36).substr(2, 9),
                                name: file.name,
                                size: file.size,
                                file: file,
                                status: 'queued',
                                progress: 0,
                                reduction: 0,
                                downloadUrl: null,
                                resultName: null,
                                blob: null
                            });
                        }
                    }
                });
            },

            removeFile(index) {
                const file = this.files[index];
                if (file.downloadUrl) URL.revokeObjectURL(file.downloadUrl);
                this.files.splice(index, 1);
            },

            clearAll() {
                this.files.forEach(f => {
                    if (f.downloadUrl) URL.revokeObjectURL(f.downloadUrl);
                });
                this.files = [];
                this.processing = false;
            },

            async processAll() {
                if (this.processing) return;
                this.processing = true;

                for (let i = 0; i < this.files.length; i++) {
                    if (this.files[i].status === 'queued') {
                        await this.compressFile(i);
                    }
                }

                this.processing = false;
            },

            async compressFile(index) {
                const f = this.files[index];
                f.status = 'processing';

                try {
                    const arrayBuffer = await f.file.arrayBuffer();
                    const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
                    
                    // Optimization Strategy based on Intensity
                    if (this.intensity !== 'low') {
                        // Strip generic metadata
                        pdfDoc.setTitle('');
                        pdfDoc.setAuthor('');
                        pdfDoc.setSubject('');
                        pdfDoc.setKeywords([]);
                        pdfDoc.setCreator('');
                        pdfDoc.setProducer('');
                        
                        if (this.intensity === 'high') {
                            // Aggressive pruning if possible (XMP metadata etc)
                            // pdf-lib doesn't have a direct "strip all" but re-saving helps
                        }
                    }

                    // Save with structural optimization
                    const compressedBytes = await pdfDoc.save({
                        useObjectStreams: true,
                        addDefaultPage: false,
                        updateMetadata: this.intensity === 'low', // Don't update/touch metadata if low
                        objectsPerStream: this.intensity === 'high' ? 100 : 50
                    });

                    const blob = new Blob([compressedBytes], { type: 'application/pdf' });
                    f.blob = blob;
                    f.downloadUrl = URL.createObjectURL(blob);
                    f.resultName = `compressed_${f.name}`;
                    f.status = 'done';
                    
                    const reductionVal = ((f.size - blob.size) / f.size) * 100;
                    f.reduction = reductionVal > 0 ? reductionVal.toFixed(1) : 0;

                } catch (error) {
                    console.error(`Compression failed for ${f.name}:`, error);
                    f.status = 'error';
                }
            },

            async downloadZip() {
                const zip = new JSZip();
                const processedFiles = this.files.filter(f => f.status === 'done');
                
                processedFiles.forEach(f => {
                    zip.file(f.resultName, f.blob);
                });

                const content = await zip.generateAsync({ type: 'blob' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(content);
                link.download = `compressed_pdfs_${Date.now()}.zip`;
                link.click();
            },

            formatSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
        }
    }
</script>
